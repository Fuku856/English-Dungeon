# English Dungeon

英語学習RPGゲームです。ダンジョンを探索しながら、様々な英語ミニゲームで敵と戦い、英語力を高めることができます。

## 基本操作

### パソコン (キーボード)
- **移動**: 矢印キー (↑ ↓ ← →)
- **決定 / アクション**: Z または Enter
- **キャンセル / メニュー / 戻る**: X または Backspace

### スマートフォン / タブレット (タッチ操作)
- 画面上に表示される仮想コントローラー（矢印ボタン、Aボタン、Bボタン）をタップして操作します。

## ゲームモードと問題形式
敵とのバトルは、以下の5種類のミニゲーム形式でランダムに発生します。

### 1. Type A: Slash (単語力)
- **ルール**: 画面上を飛び回る「日本語訳のオーブ」の中から、表示された英単語に対応する正しいものを選んで斬ります（タップ/クリック）。
- **目的**: 素早く正確な単語の意味を答える反射神経を鍛えます。

### 2. Type B: Shield (文法力)
- **ルール**: 英文の空欄（`___`）に当てはまる正しい語句を4つの選択肢から選びます。
- **目的**: 正しい文法知識で防御を固めます。

### 3. Type C: Magic (語順力)
- **ルール**: バラバラに配置された英単語を、正しい語順（意味の通る文章）になるように順番に選びます。
- **目的**: 構文構成力を高め、魔法を発動させます。

### 4. Type D: Echo (リスニング力)
- **ルール**: 読み上げられる英単語を聞き取り、正しい単語を4つの選択肢から選びます。
- **目的**: 耳で聞いて即座に理解するリスニング力を養います。

### 5. Type E: Talk (会話力)
- **ルール**: 相手（敵）のセリフに対して、文脈として最も適切な返答を3つの選択肢から選びます。
- **目的**: 状況に応じた適切な会話表現を学びます。

---

## 管理者向け: 問題の追加・編集方法

問題データはすべて `js/data.js` ファイルに記述されています。このファイルを編集することで、新しい問題を追加したり、既存の問題を修正したりできます。

### 手順
1. `js/data.js` をテキストエディタで開きます。
2. 編集したいゲームタイプのリスト変数（`vocabList` など）を探します。
3. 既存のデータの形式に従って、新しいデータを追加します。

### データ記述フォーマット

#### Type A: Slash (単語リスト)
変数名: `vocabList`
```javascript
{ 
    en: "英単語", 
    jp: "日本語訳" 
}
```

#### Type B: Shield (文法問題リスト)
変数名: `grammarList`
```javascript
{ 
    q: "問題文 (空欄は ___ と記述)", 
    options: ["選択肢1", "選択肢2", "選択肢3", "選択肢4"], 
    ans: "正解の文字列 (optionsに含まれるもの)" 
}
```

#### Type C: Magic (語順問題リスト)
変数名: `syntaxList`
```javascript
{ 
    jp: "日本語訳文", 
    words: ["英単語1", "英単語2", "英単語3", "英単語4"] // 正しい順序で記述
}
```

#### Type D: Echo (リスニング問題リスト)
変数名: `listeningList`
```javascript
{ 
    text: "読み上げる英単語", 
    options: ["選択肢1", "選択肢2", "選択肢3", "選択肢4"] // textと同じ単語を含める
}
```

#### Type E: Talk (会話問題リスト)
変数名: `conversationList`
```javascript
{ 
    q: "相手のセリフ", 
    options: ["返答1", "返答2", "返答3"], 
    ans: 0 // 正解の選択肢のインデックス (0が1番目, 1が2番目, 2が3番目)
}
```

## 制限時間の変更

各ゲームタイプの制限時間は `js/main.js` ファイルの冒頭にある `TIME_LIMITS` 定数で定義されています。この数値を変更することで、難易度を調整できます。初期値は以下の通りです。

```javascript
// js/main.js
const TIME_LIMITS = {
    'A': 15, // Slash (単語) の秒数
    'B': 10, // Shield (文法) の秒数
    'C': 15, // Magic (語順) の秒数
    'D': 10, // Echo (リスニング) の秒数
    'E': 10  // Talk (会話) の秒数
};
```

## ワールド（マップ）の構造と編集

マップの生成ロジックは `js/main.js` の `generateMap()` 関数で定義されています。現在は簡易的な10x10のグリッドダンジョンが自動生成されます。

### マップデータ構造

マップは2次元配列 `this.map[y][x]` で管理されており、各セルには以下の数値が格納されています。

- **0**: 壁 (`SPRITES.WALL`) - マップの外周などに使用
- **1**: 床 (`SPRITES.FLOOR`) - プレイヤーが移動可能なエリア
- **2**: 階段 (`SPRITES.STAIRS`) - 次のフロアへ進む出口

### マップのカスタマイズ方法

マップのレイアウトを変更したい場合は、`js/main.js` 内の `generateMap()` 関数を編集します。

```javascript
// js/main.js

generateMap() {
    // 10x10のグリッドを全て「1 (床)」で初期化
    this.map = Array(10).fill().map(() => Array(10).fill(1));

    // 外周を「0 (壁)」にする
    for (let y = 0; y < 10; y++) {
        for (let x = 0; x < 10; x++) {
            if (x === 0 || x === 9 || y === 0 || y === 9) this.map[y][x] = 0;
        }
    }

    // 特定の座標に障害物（壁）を置く例
    // this.map[3][3] = 0;
    // this.map[3][4] = 0;

    // 出口（階段）の位置設定 (例: 右下)
    this.map[8][8] = 2; 
}
```

壁や床のデザインを変更したい場合は、`js/sprites.js` のドット絵定義を編集してください。